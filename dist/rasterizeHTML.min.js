/*! rasterizeHTML.js - v0.6.0 - 2013-12-12
* http://www.github.com/cburgmer/rasterizeHTML.js
* Copyright (c) 2013 Christoph Burgmer; Licensed  */
!function(a){"object"==typeof exports?module.exports=a():"function"==typeof define&&define.amd?define(a):"undefined"!=typeof window?window.rasterizeHTML=a():"undefined"!=typeof global?global.rasterizeHTML=a():"undefined"!=typeof self&&(self.rasterizeHTML=a())}(function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b){"use strict";var c=a("./inlineUtil"),d=a("./inlineCss"),e=function(a){return c.joinUrl(a,".")},f=function(a){var b=a.map(function(b,c){return c===a.length-1&&(b={baseUrl:e(b.baseUrl)}),JSON.stringify(b)});return b},g=function(a,b){return b.cache!==!1&&"none"!==b.cache&&b.cacheBucket?c.memoize(a,f,b.cacheBucket):a},h=function(a,b,d,e){var f=a.attributes.src?a.attributes.src.nodeValue:null,g=c.getDocumentBaseUrl(a.ownerDocument),h=c.clone(b);return null===f||c.isDataUri(f)?(d(),void 0):(!h.baseUrl&&g&&(h.baseUrl=g),c.getDataURIForImageURL(f,h,function(b){a.attributes.src.nodeValue=b,d()},function(){e(c.joinUrl(h.baseUrl,f))}),void 0)},i=function(a){return Array.prototype.filter.call(a,function(a){return"image"===a.type})};b.exports.loadAndInlineImages=function(a,b,d){var e=c.parseOptionalParameters(b,d),f=a.getElementsByTagName("img"),g=a.getElementsByTagName("input"),j=[],k=[];j=Array.prototype.slice.call(f),j=j.concat(i(g)),c.map(j,function(a,b){h(a,e.options,b,function(a){k.push({resourceType:"image",url:a,msg:"Unable to load image "+a}),b()})},function(){e.callback&&e.callback(k)})};var j=function(a,b,c,e){var f=d.rulesForCssText(a);d.loadCSSImportsForRules(f,b,c,function(b,g){d.loadAndInlineCSSResourcesForRules(f,c,function(c,h){var i=g.concat(h),j=b||c;j&&(a=d.cssRulesToText(f)),e(j,a,i)})})},k=function(a,b,d,e){var f=a.textContent,h=g(j,b);h(f,d,b,function(b,d,f){f=c.cloneArray(f),b&&(a.childNodes[0].nodeValue=d),e(f)})},l=function(a){var b=a.getElementsByTagName("style");return Array.prototype.filter.call(b,function(a){return!a.attributes.type||"text/css"===a.attributes.type.nodeValue})};b.exports.loadAndInlineStyles=function(a,b,d){var e,f=c.parseOptionalParameters(b,d),g=l(a),h=[],i=[];e=c.clone(f.options),e.baseUrl=e.baseUrl||c.getDocumentBaseUrl(a),c.map(g,function(a,b){k(a,e,i,function(a){h=h.concat(a),b()})},function(){f.callback(h)})};var m=function(a,b){var c,d=a.parentNode;b=b.trim(),b&&(c=a.ownerDocument.createElement("style"),c.type="text/css",c.appendChild(a.ownerDocument.createTextNode(b)),d.insertBefore(c,a)),d.removeChild(a)},n=function(a,b,e,f){c.ajax(a,b,function(c){var f,g=d.rulesForCssText(c);f=d.adjustPathsOfCssResources(a,g),d.loadCSSImportsForRules(g,[],b,function(a,h){d.loadAndInlineCSSResourcesForRules(g,b,function(b,i){var j=h.concat(i);(f||a||b)&&(c=d.cssRulesToText(g)),e(c,j)})})},f)},o=function(a,b,d,e){var f=a.attributes.href.nodeValue,h=c.getDocumentBaseUrl(a.ownerDocument),i=c.clone(b);!i.baseUrl&&h&&(i.baseUrl=h);var j=g(n,b);j(f,i,function(a,b){b=c.cloneArray(b),d(a,b)},function(){e(c.joinUrl(i.baseUrl,f))})},p=function(a){var b=a.getElementsByTagName("link");return Array.prototype.filter.call(b,function(a){return a.attributes.rel&&"stylesheet"===a.attributes.rel.nodeValue&&(!a.attributes.type||"text/css"===a.attributes.type.nodeValue)})};b.exports.loadAndInlineCssLinks=function(a,b,d){var e=c.parseOptionalParameters(b,d),f=p(a),g=[];c.map(f,function(a,b){o(a,e.options,function(c,d){m(a,c+"\n"),g=g.concat(d),b()},function(a){g.push({resourceType:"stylesheet",url:a,msg:"Unable to load stylesheet "+a}),b()})},function(){e.callback&&e.callback(g)})};var q=function(a,b,d,e){var f=a.attributes.src.nodeValue,g=c.getDocumentBaseUrl(a.ownerDocument),h=c.clone(b);!h.baseUrl&&g&&(h.baseUrl=g),c.ajax(f,h,d,function(){e(c.joinUrl(h.baseUrl,f))})},r=function(a){return a.replace(/<\//g,"<\\/")},s=function(a,b){a.attributes.removeNamedItem("src"),a.textContent=r(b)},t=function(a){var b=a.getElementsByTagName("script");return Array.prototype.filter.call(b,function(a){return!!a.attributes.src})};b.exports.loadAndInlineScript=function(a,b,d){var e=c.parseOptionalParameters(b,d),f=t(a),g=[];c.map(f,function(a,b){q(a,e.options,function(c){s(a,c),b()},function(a){g.push({resourceType:"script",url:a,msg:"Unable to load script "+a}),b()})},function(){e.callback&&e.callback(g)})},b.exports.inlineReferences=function(a,c,d){var e=[];b.exports.loadAndInlineImages(a,c,function(f){e=e.concat(f),b.exports.loadAndInlineStyles(a,c,function(f){e=e.concat(f),b.exports.loadAndInlineCssLinks(a,c,function(f){e=e.concat(f),c.inlineScripts===!1?d(e):b.exports.loadAndInlineScript(a,c,function(a){e=e.concat(a),d(e)})})})})}},{"./inlineCss":2,"./inlineUtil":3}],2:[function(a,b){"use strict";var c=a("./requireExternalDependencyWorkaround"),d=c("cssom"),e=a("./inlineUtil"),f=function(a){var b,c=document.implementation.createHTMLDocument(""),d=document.createElement("style");return d.textContent=a,c.body.appendChild(d),b=d.sheet.cssRules,Array.prototype.slice.call(b)},g=function(){var a=f("a{background:url(i)}");return!a.length||a[0].cssText.indexOf("url()")>=0}();b.exports.rulesForCssText=function(a){return g&&d.parse?d.parse(a).cssRules:f(a)};var h=function(a){return a.filter(function(a){return a.type===window.CSSRule.STYLE_RULE&&(a.style.getPropertyValue("background-image")||a.style.getPropertyValue("background"))})},i=function(a){return a.filter(function(a){return a.type===window.CSSRule.FONT_FACE_RULE&&a.style.getPropertyValue("src")})};b.exports.cssRulesToText=function(a){return a.reduce(function(a,b){return a+b.cssText},"")};var j=function(a){var b=/^"(.*)"$/,c=/^'(.*)'$/;return b.test(a)?a.replace(b,"$1"):c.test(a)?a.replace(c,"$1"):a},k=function(a){var b=/^[\t\r\f\n ]*(.+?)[\t\r\f\n ]*$/;return a.replace(b,"$1")};b.exports.extractCssUrl=function(a){var b,c=/^url\(([^\)]+)\)/;if(!c.test(a))throw new Error("Invalid url");return b=c.exec(a)[1],j(k(b))};var l=function(a){var b,c=/^format\(([^\)]+)\)/;return c.test(a)?(b=c.exec(a)[1],j(b)):null},m=function(a){var c,d=null;try{return c=b.exports.extractCssUrl(a[0]),a[1]&&(d=l(a[1])),{url:c,format:d}}catch(e){}},n=function(a,b,c){var d=a.indexOf(b),e=b.parentStyleSheet;e.insertRule(c,d+1),e.deleteRule(d),a[d]=e.cssRules[d]},o=function(a,b,c){var d="@font-face { font-family: "+b.style.getPropertyValue("font-family")+"; ";b.style.getPropertyValue("font-style")&&(d+="font-style: "+b.style.getPropertyValue("font-style")+"; "),b.style.getPropertyValue("font-weight")&&(d+="font-weight: "+b.style.getPropertyValue("font-weight")+"; "),d+="src: "+c+"}",n(a,b,d)},p=function(a){return a.filter(function(a){return a.type===window.CSSRule.IMPORT_RULE&&a.href})},q=function(a){var b=a.map(function(a){return a.join(" ")});return b.join(", ")},r=function(a){var b,c="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",d="(local\\("+c+"\\))|(url\\("+c+"\\))(?:\\s+(format\\("+c+"\\)))?",e="^\\s*("+d+")(?:\\s*,\\s*("+d+"))*\\s*$",f=new RegExp(d,"g"),g=[],h=function(a){var b=[];return a.slice(1).forEach(function(a){a&&b.push(a)}),b};if(a.match(new RegExp(e))){for(b=f.exec(a);b;)g.push(h(b)),b=f.exec(a);return g}return[]},s=function(a){var b=[];return a.forEach(function(a){b.push(a.join(" "))}),b.join(", ")},t=function(a){var b,c="\\s*(?:\"[^\"]*\"|'[^']*'|[^\\(]+)\\s*",d="(url\\("+c+"\\)|[^,\\s]+)",e="(?:\\s*"+d+")+",f="^\\s*("+e+")(?:\\s*,\\s*("+e+"))*\\s*$",g=new RegExp(e,"g"),h=[],i=function(a){var b,c=new RegExp(d,"g"),e=[];for(b=c.exec(a);b;)e.push(b[1]),b=c.exec(a);return e};if(a.match(new RegExp(f))){for(b=g.exec(a);b;)h.push(i(b[0])),b=g.exec(a);return h}return[]},u=function(a){var c,d;for(c=0;c<a.length;c++)try{return d=b.exports.extractCssUrl(a[c]),{url:d,idx:c}}catch(e){}};b.exports.adjustPathsOfCssResources=function(a,b){var c,d=!1;return h(b).forEach(function(b){var f=b.style.getPropertyValue("background-image")||b.style.getPropertyValue("background"),g=t(f),h=!1;g.forEach(function(b){var c,d=u(b);d&&!e.isDataUri(d.url)&&(c=e.joinUrl(a,d.url),b[d.idx]='url("'+c+'")',h=!0)}),c=q(g),b.style.getPropertyValue("background-image")?b.style.setProperty("background-image",c):b.style.setProperty("background",c),d=d||h}),i(b).forEach(function(c){var f=r(c.style.getPropertyValue("src")),g=!1;f.forEach(function(b){var c,d=m(b);d&&!e.isDataUri(d.url)&&(c=e.joinUrl(a,d.url),b[0]='url("'+c+'")',g=!0)}),g&&o(b,c,s(f)),d=d||g}),p(b).forEach(function(c){var f=c.href,g=e.joinUrl(a,f);n(b,c,"@import url("+g+");"),d=!0}),d};var v=function(a,b,c){var d=a.indexOf(b);a.splice(d,1),c.forEach(function(b,c){a.splice(d+c,0,b)})},w=function(a){var b=/^"(.*)"$/,c=/^'(.*)'$/;return b.test(a)||c.test(a)},x=function(a,c,d,f,g,h){var i,k=c.href;return w(k)&&(k=j(k)),i=e.joinUrl(f.baseUrl,k),d.indexOf(i)>=0?(v(a,c,[]),g([]),void 0):(d.push(i),e.ajax(k,f,function(e){var h=b.exports.rulesForCssText(e);b.exports.loadCSSImportsForRules(h,d,f,function(d,e){b.exports.adjustPathsOfCssResources(k,h),v(a,c,h),g(e)})},function(){h(i)}),void 0)};b.exports.loadCSSImportsForRules=function(a,b,c,d){var f,g=[];f=p(a),e.map(f,function(d,e){x(a,d,b,c,function(a){g=g.concat(a),e(!0)},function(a){g.push({resourceType:"stylesheet",url:a,msg:"Unable to load stylesheet "+a}),e(!1)})},function(a){var b=a.indexOf(!0)>=0;d(b,g)})};var y=function(a,b,c){var d,f,g=[],h=a.style.getPropertyValue("background-image")||a.style.getPropertyValue("background");d=t(h),e.map(d,function(a,c){var d=u(a);return!d||e.isDataUri(d.url)?(c(!1),void 0):(e.getDataURIForImageURL(d.url,b,function(b){a[d.idx]='url("'+b+'")',c(!0)},function(){g.push(e.joinUrl(b.baseUrl,d.url)),c(!1)}),void 0)},function(b){var e=b.indexOf(!0)>=0;e&&(f=q(d),a.style.getPropertyValue("background-image")?a.style.setProperty("background-image",f):a.style.setProperty("background",f)),c(e,g)})},z=function(a,b,c){var d,f=h(a),g=[];e.map(f,function(a,c){y(a,b,function(a,b){b.forEach(function(a){g.push({resourceType:"backgroundImage",url:a,msg:"Unable to load background-image "+a})}),c(a)})},function(a){d=a.indexOf(!0)>=0,c(d,g)})},A=function(a,b,c,d){var f,g,h,i,j=[];f=r(b.style.getPropertyValue("src")),e.map(f,function(a,b){return g=m(a),!g||e.isDataUri(g.url)?(b(!1),void 0):(h=g.format||"woff",e.binaryAjax(g.url,c,function(c){i=btoa(c),a[0]='url("data:font/'+h+";base64,"+i+'")',b(!0)},function(){j.push(e.joinUrl(c.baseUrl,g.url)),b(!1)}),void 0)},function(c){var e=c.indexOf(!0)>=0;e&&o(a,b,s(f)),d(e,j)})},B=function(a,b,c){var d,f=i(a),g=[];e.map(f,function(c,d){A(a,c,b,function(a,b){b.forEach(function(a){g.push({resourceType:"fontFace",url:a,msg:"Unable to load font-face "+a})}),d(a)})},function(a){d=a.indexOf(!0)>=0,c(d,g)})};b.exports.loadAndInlineCSSResourcesForRules=function(a,b,c){z(a,b,function(d,e){B(a,b,function(a,b){var f=d||a;c(f,e.concat(b))})})}},{"./inlineUtil":3,"./requireExternalDependencyWorkaround":5}],3:[function(a,b){"use strict";var c=a("./requireExternalDependencyWorkaround"),d=c("url");b.exports.getDocumentBaseUrl=function(a){return"about:blank"!==a.baseURI?a.baseURI:null},b.exports.clone=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},b.exports.cloneArray=function(a){return Array.prototype.slice.apply(a,[0])},b.exports.joinUrl=function(a,b){return d.resolve(a,b)},b.exports.isDataUri=function(a){return/^data:/.test(a)},b.exports.map=function(a,c,d){var e,f=0,g=b.exports.cloneArray(a),h=[];0===g.length&&d(h);var i=function(a){function b(b){f+=1,h[a]=b,f===g.length&&d(h)}c(g[a],b)};for(e=0;e<g.length;e++)i(e)};var e=null,f=function(a,b){return b===!1||"none"===b||"repeated"===b?((null===e||"repeated"!==b)&&(e=Date.now()),a+"?_="+e):a};b.exports.ajax=function(a,c,d,e){var g,h=new window.XMLHttpRequest,i=b.exports.joinUrl(c.baseUrl,a);g=f(i,c.cache),h.addEventListener("load",function(){200===h.status||0===h.status?d(h.response):e()},!1),h.addEventListener("error",function(){e()},!1);try{h.open("GET",g,!0),h.overrideMimeType(c.mimeType),h.send(null)}catch(j){e()}},b.exports.binaryAjax=function(a,c,d,e){var f="",g=b.exports.clone(c);g.mimeType="text/plain; charset=x-user-defined",b.exports.ajax(a,g,function(a){for(var b=0;b<a.length;b++)f+=String.fromCharCode(255&a.charCodeAt(b));d(f)},e)};var g=function(a){var b=function(a,b){return a.substring(0,b.length)===b};return b(a,"<?xml")||b(a,"<svg")?"image/svg+xml":"image/png"};b.exports.getDataURIForImageURL=function(a,c,d,e){var f,h;b.exports.binaryAjax(a,c,function(a){f=btoa(a),h=g(a),d("data:"+h+";base64,"+f)},function(){e()})};var h=[],i=function(a){return h.indexOf(a)<0&&h.push(a),h.indexOf(a)};b.exports.memoize=function(a,b,c){if("object"!=typeof c)throw new Error("cacheBucket is not an object");return function(){var d,e,f=Array.prototype.slice.call(arguments);f.length>2&&"function"==typeof f[f.length-2]?(e=f.pop(),d=f.pop()):d=f.pop();var g,h=b(f),j=i(a);c[j]&&c[j][h]?d.apply(null,c[j][h]):(g=f.concat(function(){c[j]=c[j]||{},c[j][h]=arguments,d.apply(null,arguments)}),e&&(g=g.concat(e)),a.apply(null,g))}};var j=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},k=function(a){return"function"==typeof a};b.exports.parseOptionalParameters=function(){var a={options:{},callback:null};return k(arguments[0])?a.callback=arguments[0]:(a.options=j(arguments[0]),a.callback=arguments[1]||null),a}},{"./requireExternalDependencyWorkaround":5}],4:[function(a,b){"use strict";var c=a("./requireExternalDependencyWorkaround"),d=c("xmlserializer"),e=a("./util"),f=a("./inlineUtil"),g=a("./inline"),h=function(){if(window.navigator.userAgent.indexOf("WebKit")>=0&&window.navigator.userAgent.indexOf("Chrome")<0)return!1;if(window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder)return!0;if(window.Blob)try{return new window.Blob(["<b></b>"],{type:"text/xml"}),!0}catch(a){return!1}return!1},i=function(a){var b,c="image/svg+xml;charset=utf-8",d=window.BlobBuilder||window.MozBlobBuilder||window.WebKitBlobBuilder;return d?(b=new d,b.append(a),b.getBlob(c)):new window.Blob([a],{type:c})},j=function(a){var b=window.URL||window.webkitURL||window;return h()?b.createObjectURL(i(a)):"data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a)},k=function(a){var b=window.URL||window.webkitURL||window;h()&&b.revokeObjectURL(a)},l="rasterizeHTML_js_FirefoxWorkaround",m=function(){var a=window.navigator.userAgent.match(/Firefox\/(\d+).0/);return!a||!a[1]||parseInt(a[1],10)<17},n=function(a,b){var c=a.getElementById(b);return c||(c=e.createHiddenElement(a,"div"),c.id=b),c},o=function(a,b){var c,d=e.getConstantUniqueIdFor(a),f=b?b.ownerDocument:window.document;m()&&(c=n(f,l+d),c.innerHTML=a,c.className=l)},p=function(a){window.navigator.userAgent.indexOf("WebKit")>=0&&Array.prototype.forEach.call(a.getElementsByTagName("style"),function(a){a.textContent="span {}\n"+a.textContent})},q=function(a,b){var c=e.getConstantUniqueIdFor(a),d=b?b.ownerDocument:window.document,f=d.getElementById(l+c);f&&f.parentNode.removeChild(f)};b.exports.getSvgForDocument=function(a,b,c){var e;return p(a),e=d.serializeToString(a),'<svg xmlns="http://www.w3.org/2000/svg" width="'+b+'" height="'+c+'"><foreignObject width="100%" height="100%">'+e+"</foreignObject></svg>"},b.exports.renderSvg=function(a,b,c,d){var e,f,g=function(){f.onload=null,f.onerror=null},h=function(){e&&k(e),q(a,b)};o(a,b),e=j(a),f=new window.Image,f.onload=function(){g(),h(),c(f)},f.onerror=function(){h(),d()},f.src=e},b.exports.drawImageOnCanvas=function(a,b){try{b.getContext("2d").drawImage(a,0,0)}catch(c){return!1}return!0};var r=function(a,b){var c=300,d=200,e=a?a.width:c,f=a?a.height:d,g=void 0!==b.width?b.width:e,h=void 0!==b.height?b.height:f;return{width:g,height:h}};b.exports.drawDocumentImage=function(a,c,d,f,g){var h=r(c,d);d.hover&&e.fakeHover(a,d.hover),d.active&&e.fakeActive(a,d.active),e.calculateDocumentContentSize(a,h.width,h.height,function(d,e){var h=b.exports.getSvgForDocument(a,d,e);b.exports.renderSvg(h,c,function(a){f(a)},g)})};var s=function(a,c,d,e,f){var g=function(a){a.push({resourceType:"document",msg:"Error rendering page"})};b.exports.drawDocumentImage(a,c,d,function(a){var d;c&&(d=b.exports.drawImageOnCanvas(a,c),d||(g(f),a=null)),e&&e(a,f)},function(){g(f),e&&e(null,f)})},t=function(a,b,c,d){var h,i=c.executeJsTimeout||0;h=f.clone(c),h.inlineScripts=c.executeJs===!0,g.inlineReferences(a,h,function(f){c.executeJs?e.executeJavascript(a,c.baseUrl,i,function(a,g){e.persistInputValues(a),s(a,b,c,d,f.concat(g))}):s(a,b,c,d,f)})};b.exports.drawDocument=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=e.parseOptionalParameters(b);t(a,c.canvas,c.options,c.callback)};var u=function(a,c,d,f){var g=e.parseHTML(a);b.exports.drawDocument(g,c,d,f)};b.exports.drawHTML=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=e.parseOptionalParameters(b);u(a,c.canvas,c.options,c.callback)};var v=function(a,c,d,f){e.loadDocument(a,d,function(a){b.exports.drawDocument(a,c,d,f)},function(){f&&f(null,[{resourceType:"page",url:a,msg:"Unable to load page "+a}])})};b.exports.drawURL=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1),c=e.parseOptionalParameters(b);v(a,c.canvas,c.options,c.callback)}},{"./inline":1,"./inlineUtil":3,"./requireExternalDependencyWorkaround":5,"./util":6}],5:[function(a,b){b.exports=function(b){try{if("cssom"===b)return a("cssom");if("url"===b)return a("url");if("xmlserializer"===b)return a("xmlserializer")}catch(c){if("undefined"!=typeof window&&(window[b]||window[b.toUpperCase()]))return window[b]||window[b.toUpperCase()];throw c}}},{cssom:!1,url:!1,xmlserializer:!1}],6:[function(a,b){var c=a("./inlineUtil"),d=[];b.exports.getConstantUniqueIdFor=function(a){return d.indexOf(a)<0&&d.push(a),d.indexOf(a)};var e=function(a){var b,c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c},f=function(a){return"object"==typeof a&&null!==a},g=function(a){return f(a)&&Object.prototype.toString.apply(a).match(/\[object (Canvas|HTMLCanvasElement)\]/i)},h=function(a){return"function"==typeof a};b.exports.parseOptionalParameters=function(a){var b={canvas:null,options:{},callback:null};return h(a[0])?b.callback=a[0]:null==a[0]||g(a[0])?(b.canvas=a[0]||null,h(a[1])?b.callback=a[1]:(b.options=e(a[1]),b.callback=a[2]||null)):(b.options=e(a[0]),b.callback=a[1]||null),b};var i=function(a,b){return function(){var d=new a,e=d.open;return d.open=function(){var a=Array.prototype.slice.call(arguments),d=a.shift(),f=a.shift(),g=c.joinUrl(b,f);return e.apply(this,[d,g].concat(a))},d}};b.exports.createHiddenElement=function(a,b){var c=a.createElement(b);return c.style.visibility="hidden",c.style.width="0px",c.style.height="0px",c.style.position="absolute",c.style.top="-10000px",c.style.left="-10000px",a.getElementsByTagName("body")[0].appendChild(c),c},b.exports.executeJavascript=function(a,c,d,e){var f=b.exports.createHiddenElement(window.document,"iframe"),g=a.documentElement.outerHTML,h=[],j=function(){var a=f.contentDocument;window.document.getElementsByTagName("body")[0].removeChild(f),e(a,h)};f.onload=d>0?function(){setTimeout(j,d)}:j,f.contentDocument.open(),f.contentWindow.XMLHttpRequest=i(f.contentWindow.XMLHttpRequest,c),f.contentWindow.onerror=function(a){h.push({resourceType:"scriptExecution",msg:a})},f.contentDocument.write(g),f.contentDocument.close()};var j=function(a,b,c){var d=a.createElement("iframe");return d.style.width=b+"px",d.style.height=c+"px",d.style.visibility="hidden",d.style.position="absolute",d.style.top=-1e4-c+"px",d.style.left=-1e4-b+"px",d.sandbox="allow-same-origin",a.getElementsByTagName("body")[0].appendChild(d),d};b.exports.calculateDocumentContentSize=function(a,b,c,d){var e=a.documentElement.outerHTML,f=j(window.document,b,c);f.onload=function(){var a=f.contentDocument,b=Math.max(a.documentElement.scrollWidth,a.body.clientWidth),c=Math.max(a.documentElement.scrollHeight,a.body.scrollHeight,a.body.clientHeight);window.document.getElementsByTagName("body")[0].removeChild(f),d(b,c)},f.contentDocument.open(),f.contentDocument.write(e),f.contentDocument.close()};var k=function(a,b){var c,d,e,f,g=/<html((?:\s+[^>]*)?)>/im.exec(b),h=window.document.implementation.createHTMLDocument("");if(g)for(c="<div"+g[1]+"></div>",h.documentElement.innerHTML=c,e=h.querySelector("div"),d=0;d<e.attributes.length;d++)f=e.attributes[d],a.documentElement.setAttribute(f.name,f.value)};b.exports.parseHTML=function(a){var b;return(new DOMParser).parseFromString("<a></a>","text/html")?b=(new DOMParser).parseFromString(a,"text/html"):(b=window.document.implementation.createHTMLDocument(""),b.documentElement.innerHTML=a,k(b,a)),b};var l=null,m=function(a,b){return b===!1||"none"===b||"repeated"===b?((null===l||"repeated"!==b)&&(l=Date.now()),a+"?_="+l):a};b.exports.loadDocument=function(a,b,d,e){var f=new window.XMLHttpRequest,g=c.joinUrl(b.baseUrl,a),h=m(g,b.cache);f.addEventListener("load",function(){200===f.status||0===f.status?d(f.responseXML):e()},!1),f.addEventListener("error",function(){e()},!1);try{f.open("GET",h,!0),f.responseType="document",f.send(null)}catch(i){e()}},b.exports.addClassNameRecursively=function(a,c){a.className+=" "+c,a.parentNode!==a.ownerDocument&&b.exports.addClassNameRecursively(a.parentNode,c)};var n=function(a,b){var c=a.parentStyleSheet,d=Array.prototype.indexOf.call(c.cssRules,a);c.insertRule(b,d+1),c.deleteRule(d)},o=function(a,b){var c=a.cssText.replace(/^[^\{]+/,""),d=b+" "+c;n(a,d)},p=function(a){return Array.prototype.reduce.call(a,function(a,b){return a+b.cssText},"")},q=function(a){a.textContent=p(a.sheet.cssRules)};b.exports.rewriteStyleRuleSelector=function(a,b,c){var d=new RegExp(b+"(?=\\W|$)","g");Array.prototype.forEach.call(a.querySelectorAll("style"),function(a){var b=Array.prototype.filter.call(a.sheet.cssRules,function(a){return a.selectorText&&d.test(a.selectorText)});b.length&&(b.forEach(function(a){var b=a.selectorText.replace(d,c);o(a,b)}),q(a))})},b.exports.fakeHover=function(a,c){var d=a.querySelector(c),e="rasterizehtmlhover";d&&(b.exports.addClassNameRecursively(d,e),b.exports.rewriteStyleRuleSelector(a,":hover","."+e))},b.exports.fakeActive=function(a,c){var d=a.querySelector(c),e="rasterizehtmlactive";d&&(b.exports.addClassNameRecursively(d,e),b.exports.rewriteStyleRuleSelector(a,":active","."+e))},b.exports.persistInputValues=function(a){var b=Array.prototype.slice.call(a.querySelectorAll("input")),c=Array.prototype.slice.call(a.querySelectorAll("textarea")),d=function(a){return"checkbox"===a.type||"radio"===a.type};b.filter(d).forEach(function(a){a.checked?a.setAttribute("checked",""):a.removeAttribute("checked")}),b.filter(function(a){return!d(a)}).forEach(function(a){a.setAttribute("value",a.value)}),c.forEach(function(a){a.textContent=a.value})}},{"./inlineUtil":3}]},{},[4])(4)});